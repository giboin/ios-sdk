!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).LyraAuth=e()}(this,function(){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var o=0;o<e.length;o++){var i=e[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function t(t,e,o){return e&&i(t.prototype,e),o&&i(t,o),t}function p(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var o=[],i=!0,n=!1,l=void 0;try{for(var s,a=t[Symbol.iterator]();!(i=(s=a.next()).done)&&(o.push(s.value),!e||o.length!==e);i=!0);}catch(t){n=!0,l=t}finally{try{i||null==a.return||a.return()}finally{if(n)throw l}}return o}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return n(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);"Object"===o&&t.constructor&&(o=t.constructor.name);if("Map"===o||"Set"===o)return Array.from(t);if("Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return n(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,i=new Array(e);o<e;o++)i[o]=t[o];return i}var e,f=(function(t){function e(t){this.opts=function(t){for(var e=1;e<arguments.length;e++)for(var o in arguments[e])arguments[e].hasOwnProperty(o)&&(t[o]=arguments[e][o]);return t}({},{onClose:null,onOpen:null,beforeOpen:null,beforeClose:null,stickyFooter:!1,footer:!1,cssClass:[],closeLabel:"Close",closeMethods:["overlay","button","escape"]},t),this.init()}function o(){this.modalBoxFooter&&(this.modalBoxFooter.style.width=this.modalBox.clientWidth+"px",this.modalBoxFooter.style.left=this.modalBox.offsetLeft+"px")}var i;t.exports=(i=!1,e.prototype.init=function(){if(!this.modal)return function(){this.modal=document.createElement("div"),this.modal.classList.add("tingle-modal"),0!==this.opts.closeMethods.length&&-1!==this.opts.closeMethods.indexOf("overlay")||this.modal.classList.add("tingle-modal--noOverlayClose"),this.modal.style.display="none",this.opts.cssClass.forEach(function(t){"string"==typeof t&&this.modal.classList.add(t)},this),-1!==this.opts.closeMethods.indexOf("button")&&(this.modalCloseBtn=document.createElement("button"),this.modalCloseBtn.type="button",this.modalCloseBtn.classList.add("tingle-modal__close"),this.modalCloseBtnIcon=document.createElement("span"),this.modalCloseBtnIcon.classList.add("tingle-modal__closeIcon"),this.modalCloseBtnIcon.innerHTML='<svg viewBox="0 0 10 10" xmlns="http://www.w3.org/2000/svg"><path d="M.3 9.7c.2.2.4.3.7.3.3 0 .5-.1.7-.3L5 6.4l3.3 3.3c.2.2.5.3.7.3.2 0 .5-.1.7-.3.4-.4.4-1 0-1.4L6.4 5l3.3-3.3c.4-.4.4-1 0-1.4-.4-.4-1-.4-1.4 0L5 3.6 1.7.3C1.3-.1.7-.1.3.3c-.4.4-.4 1 0 1.4L3.6 5 .3 8.3c-.4.4-.4 1 0 1.4z" fill="#000" fill-rule="nonzero"/></svg>',this.modalCloseBtnLabel=document.createElement("span"),this.modalCloseBtnLabel.classList.add("tingle-modal__closeLabel"),this.modalCloseBtnLabel.innerHTML=this.opts.closeLabel,this.modalCloseBtn.appendChild(this.modalCloseBtnIcon),this.modalCloseBtn.appendChild(this.modalCloseBtnLabel)),this.modalBox=document.createElement("div"),this.modalBox.classList.add("tingle-modal-box"),this.modalBoxContent=document.createElement("div"),this.modalBoxContent.classList.add("tingle-modal-box__content"),this.modalBox.appendChild(this.modalBoxContent),-1!==this.opts.closeMethods.indexOf("button")&&this.modal.appendChild(this.modalCloseBtn),this.modal.appendChild(this.modalBox)}.call(this),function(){this._events={clickCloseBtn:this.close.bind(this),clickOverlay:function(t){var e=this.modal.offsetWidth-this.modal.clientWidth,o=t.clientX>=this.modal.offsetWidth-15,i=this.modal.scrollHeight!==this.modal.offsetHeight;"MacIntel"===navigator.platform&&0==e&&o&&i||-1!==this.opts.closeMethods.indexOf("overlay")&&!function(t){for(;(t=t.parentElement)&&!t.classList.contains("tingle-modal"););return t}(t.target)&&t.clientX<this.modal.clientWidth&&this.close()}.bind(this),resize:this.checkOverflow.bind(this),keyboardNav:function(t){-1!==this.opts.closeMethods.indexOf("escape")&&27===t.which&&this.isOpen()&&this.close()}.bind(this)},-1!==this.opts.closeMethods.indexOf("button")&&this.modalCloseBtn.addEventListener("click",this._events.clickCloseBtn),this.modal.addEventListener("mousedown",this._events.clickOverlay),window.addEventListener("resize",this._events.resize),document.addEventListener("keydown",this._events.keyboardNav)}.call(this),document.body.appendChild(this.modal,document.body.firstChild),this.opts.footer&&this.addFooter(),this},e.prototype._busy=function(t){i=t},e.prototype._isBusy=function(){return i},e.prototype.destroy=function(){null!==this.modal&&(this.isOpen()&&this.close(!0),function(){-1!==this.opts.closeMethods.indexOf("button")&&this.modalCloseBtn.removeEventListener("click",this._events.clickCloseBtn),this.modal.removeEventListener("mousedown",this._events.clickOverlay),window.removeEventListener("resize",this._events.resize),document.removeEventListener("keydown",this._events.keyboardNav)}.call(this),this.modal.parentNode.removeChild(this.modal),this.modal=null)},e.prototype.isOpen=function(){return!!this.modal.classList.contains("tingle-modal--visible")},e.prototype.open=function(){if(!this._isBusy()){this._busy(!0);var t=this;return"function"==typeof t.opts.beforeOpen&&t.opts.beforeOpen(),this.modal.style.removeProperty?this.modal.style.removeProperty("display"):this.modal.style.removeAttribute("display"),this._scrollPosition=window.pageYOffset,document.body.classList.add("tingle-enabled"),document.body.style.top=-this._scrollPosition+"px",this.setStickyFooter(this.opts.stickyFooter),this.modal.classList.add("tingle-modal--visible"),"function"==typeof t.opts.onOpen&&t.opts.onOpen.call(t),t._busy(!1),this.checkOverflow(),this}},e.prototype.close=function(t){if(!this._isBusy()){if(this._busy(!0),"function"==typeof this.opts.beforeClose&&!this.opts.beforeClose.call(this))return void this._busy(!1);document.body.classList.remove("tingle-enabled"),document.body.style.top=null,window.scrollTo({top:this._scrollPosition,behavior:"instant"}),this.modal.classList.remove("tingle-modal--visible");this.modal.style.display="none","function"==typeof this.opts.onClose&&this.opts.onClose.call(this),this._busy(!1)}},e.prototype.setContent=function(t){return"string"==typeof t?this.modalBoxContent.innerHTML=t:(this.modalBoxContent.innerHTML="",this.modalBoxContent.appendChild(t)),this.isOpen()&&this.checkOverflow(),this},e.prototype.getContent=function(){return this.modalBoxContent},e.prototype.addFooter=function(){return function(){this.modalBoxFooter=document.createElement("div"),this.modalBoxFooter.classList.add("tingle-modal-box__footer"),this.modalBox.appendChild(this.modalBoxFooter)}.call(this),this},e.prototype.setFooterContent=function(t){return this.modalBoxFooter.innerHTML=t,this},e.prototype.getFooterContent=function(){return this.modalBoxFooter},e.prototype.setStickyFooter=function(t){return this.isOverflow()||(t=!1),t?this.modalBox.contains(this.modalBoxFooter)&&(this.modalBox.removeChild(this.modalBoxFooter),this.modal.appendChild(this.modalBoxFooter),this.modalBoxFooter.classList.add("tingle-modal-box__footer--sticky"),o.call(this),this.modalBoxContent.style["padding-bottom"]=this.modalBoxFooter.clientHeight+20+"px"):this.modalBoxFooter&&(this.modalBox.contains(this.modalBoxFooter)||(this.modal.removeChild(this.modalBoxFooter),this.modalBox.appendChild(this.modalBoxFooter),this.modalBoxFooter.style.width="auto",this.modalBoxFooter.style.left="",this.modalBoxContent.style["padding-bottom"]="",this.modalBoxFooter.classList.remove("tingle-modal-box__footer--sticky"))),this},e.prototype.addFooterBtn=function(t,e,o){var i=document.createElement("button");return i.innerHTML=t,i.addEventListener("click",o),"string"==typeof e&&e.length&&e.split(" ").forEach(function(t){i.classList.add(t)}),this.modalBoxFooter.appendChild(i),i},e.prototype.resize=function(){},e.prototype.isOverflow=function(){return window.innerHeight<=this.modalBox.clientHeight},e.prototype.checkOverflow=function(){this.modal.classList.contains("tingle-modal--visible")&&(this.isOverflow()?this.modal.classList.add("tingle-modal--overflow"):this.modal.classList.remove("tingle-modal--overflow"),!this.isOverflow()&&this.opts.stickyFooter?this.setStickyFooter(!1):this.isOverflow()&&this.opts.stickyFooter&&(o.call(this),this.setStickyFooter(!0)))},{modal:e})}(e={exports:{}}),e.exports),g=function(){function e(t){o(this,e);this.opts=this._extend({},{selector:"body",onClose:null,onOpen:null},t),this.init()}return t(e,[{key:"init",value:function(){this.content=document.createElement("div"),this.content.style.width="100%",this.content.style.height="100%",this.buildModal(),document.querySelector(this.opts.selector).appendChild(this.modal)}},{key:"buildModal",value:function(){this.modal=document.createElement("div"),this.modal.style.width="100%",this.modal.style.height="100%",this.modal.classList.add("lyngle"),this.modal.style.display="none",this.modal.appendChild(this.content)}},{key:"setContent",value:function(t){"string"==typeof t?this.content.innerHTML=t:(this.content.innerHTML="",this.content.appendChild(t))}},{key:"open",value:function(){this.modal.style.removeProperty?this.modal.style.removeProperty("display"):this.modal.style.removeAttribute("display"),this.modal.classList.add("lyngle--visible"),this.opts.onOpen&&this.opts.onOpen()}},{key:"close",value:function(){this.modal.classList.remove("lyngle--visible"),this.modal.style.display="none",this.opts.onClose&&this.opts.onClose()}},{key:"isOpen",value:function(){return!!this.modal.classList.contains("lyngle--visible")}},{key:"_extend",value:function(){for(var t=arguments.length,o=new Array(t),e=0;e<t;e++)o[e]=arguments[e];for(var i=1;i<o.length;i++)!function(e){Object.keys(o[e]).forEach(function(t){o[0][t]=o[e][t]})}(i);return o[0]}}]),e}(),y={en:{authentication:"Loading",authentication_wait:"Please wait"},fr:{authentication:"Chargement en cours",authentication_wait:"Veuillez patienter"},es:{authentication:"Cargando",authentication_wait:"Espera por favor"},it:{authentication:"Autenticazione in corso",authentication_wait:"Per favore, aspetta"},pt:{authentication:"Carregando",authentication_wait:"Por favor aguarde"}},l="LYRA_AUTH_INSTRUCTION_RESULT",s=function(){function e(){var i=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(o(this,e),this.id=(new Date).getTime(),this.options=t,this.options.debug){if("boolean"!=typeof this.options.debug)throw new Error("options.debug isn't a boolean")}else this.options.debug=!1;this.options.element||(this.options.element=document.body),window.addEventListener("message",function(t){if(i.currentInstruction){var e=t.data;try{var o=JSON.parse(e);if(o.eventName===l)try{i.currentCallback(o.value)}finally{i._handleInstructionResult(o.value)}}catch(t){"Sentry"in window&&window.Sentry.captureException(t)}}},!1)}return t(e,[{key:"delegate",value:function(t,e,o){var i=2<arguments.length&&void 0!==o?o:null,n=t.protocol,l=t.value;this.currentProtocol=n,this.currentInstruction=l,this.currentCallback=e,this.options.debug,this._addInstructionElement(i),this._subscribeToInstructionResult()}},{key:"_getElementId",value:function(){return"LYRA_".concat(this.currentInstruction.name,"_").concat(this.id)}},{key:"_isLanguageSupported",value:function(t){return t&&-1!==Object.keys(y).indexOf(t)}},{key:"_getLanguage",value:function(){var t=window.navigator.language||window.navigator.userLanguage,e=t?t.split("-")[0]:null;return this._isLanguageSupported(this.currentInstruction.language)?this.currentInstruction.language:this._isLanguageSupported(e)?e:"en"}},{key:"_addInstructionElement",value:function(t){var e,o,i,n,l=this,s=0<arguments.length&&void 0!==t?t:null,a=document.createElement("div"),r=null,d=null,c=document.createElement("iframe"),h=document.createElement("form"),u=document.createElement("div"),m=void 0===this.currentInstruction.target.showUrl||this.currentInstruction.target.showUrl;a.id=this._getElementId(),a.style.display="none",c.id="".concat(this._getElementId(),"_iframe"),c.name=c.id,c.dataset.test="LYRA-INSTRUCTION-IFRAME",c.frameBorder="0",c.style.frameBorder="0",this.currentInstruction.target.visible?(o=(e=this.currentInstruction.target.fullscreen&&m)?"calc(".concat(this.currentInstruction.target.height,"px - ").concat("3em",")"):"".concat(this.currentInstruction.target.height,"px"),s?(c.width="100%",c.height=e?"calc('100% - ".concat("3em","')"):"100%"):(c.width=this.currentInstruction.target.width,c.height=o),c.style.minWidth="".concat(this.currentInstruction.target.width,"px"),c.style.minHeight=o):(c.height="0",c.width="0",c.style.minWidth="0px",c.style.minHeight="0px"),c.setAttribute("origin",window.origin),this.currentInstruction.target.visible&&(r=document.createElement("div"),d=document.createElement("div"),r.classList.add("lyra_auth_loader"),i=this._getLanguage(),r.innerHTML='\n                <div class="auth-msg-wrapper">\n                    <div class="auth-msg">'.concat(y[i].authentication,'</div>\n                    <div class="wait-msg">').concat(y[i].authentication_wait,'</div>\n                </div>\n                <div class="loading">\n                    <div class="bullet"></div>\n                    <div class="bullet"></div>\n                    <div class="bullet"></div>\n                    <div class="bullet"></div>\n                </div>\n            '),r.style.display="block",m&&(d.classList.add("lyra_auth_header"),d.innerHTML='\n                <input id="url" title="'.concat(this.currentInstruction.http.url,'" value="').concat(this.currentInstruction.http.url,'" readonly/>\n            '))),c.src="about:blank",h.method=this.currentInstruction.http.method,h.target=c.id,h.action=this.currentInstruction.http.url,this.currentInstruction.http.body&&Object.keys(this.currentInstruction.http.body).forEach(function(t){var e,o,i=document.createElement("input");i.name=t,i.type="hidden",i.value=l.currentInstruction.http.body[t],!l.options.removePadding||"creq"!==t&&"threeDSSessionData"!==t&&"threeDSMethodData"!==t||(o=p(e=l.currentInstruction.http.body[t].split("="),1),i.value=o[0],e.length),h.appendChild(i)}),r&&u.appendChild(r),d&&u.appendChild(d),u.appendChild(c),a.appendChild(u),a.appendChild(h),this.options.element.appendChild(a),this.currentInstruction.target.visible?(n=function(){c.onload=function(){r.style.display="none"},h.submit()},this.modal=s?new g({selector:s,onOpen:n}):new f.modal({closeMethods:[],cssClass:[],onOpen:n}),this.modal.setContent(u),this.modal.open()):h.submit()}},{key:"_handleInstructionResult",value:function(t){this._removeInstructionElement(t),this.currentInstruction=null,this.currentProtocol=null,this.currentCallback=null}},{key:"_removeInstructionElement",value:function(){this.options.debug,this.currentInstruction.target.visible&&this.modal.destroy(),clearTimeout(this.instructionTimeout),document.getElementById(this._getElementId()).remove()}},{key:"_subscribeToInstructionResult",value:function(){this.currentInstruction.timeout&&this._setInstructionTimeout(this.currentInstruction.name)}},{key:"_setInstructionTimeout",value:function(e){var o=this;this.instructionTimeout=setTimeout(function(){var t={eventName:"LYRA_AUTH_INSTRUCTION_RESULT",value:{name:e,value:"TIMEOUT",protocol:o.currentProtocol}};window.postMessage(JSON.stringify(t),"*")},1e3*this.currentInstruction.timeout)}}]),e}();function a(t,e){void 0===e&&(e={});var o,i,n=e.insertAt;t&&"undefined"!=typeof document&&(o=document.head||document.getElementsByTagName("head")[0],(i=document.createElement("style")).type="text/css","top"===n&&o.firstChild?o.insertBefore(i,o.firstChild):o.appendChild(i),i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t)))}a('.tingle-modal *{box-sizing:border-box}.tingle-modal{position:fixed;top:0;right:0;bottom:0;left:0;z-index:1000;display:-ms-flexbox;display:flex;visibility:hidden;-ms-flex-direction:column;flex-direction:column;-ms-flex-align:center;align-items:center;overflow:hidden;-webkit-overflow-scrolling:touch;background:rgba(0,0,0,.8);opacity:0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;transition:transform .2s ease}.tingle-modal--confirm .tingle-modal-box{text-align:center}.tingle-modal--noOverlayClose{cursor:default}.tingle-modal--noClose .tingle-modal__close{display:none}.tingle-modal__close{position:fixed;top:10px;right:28px;z-index:1000;padding:0;width:5rem;height:5rem;border:none;background-color:transparent;color:#f0f0f0;font-size:6rem;font-family:monospace;line-height:1;cursor:pointer;transition:color .3s ease}.tingle-modal__closeLabel{display:none}.tingle-modal__close:hover{color:#fff}.tingle-modal-box{position:relative;flex-shrink:0;margin-top:auto;margin-bottom:auto;border-radius:4px;background:#fff;opacity:1;cursor:auto;transition:transform .3s cubic-bezier(.175,.885,.32,1.275);-ms-transform:scale(.8);transform:scale(.8)}.tingle-modal-box__footer{padding:1.5rem 2rem;width:auto;border-bottom-right-radius:4px;border-bottom-left-radius:4px;background-color:#f5f5f5;cursor:auto}.tingle-modal-box__footer:after{display:table;clear:both;content:""}.tingle-modal-box__footer--sticky{position:fixed;bottom:-200px;z-index:10001;opacity:1;transition:bottom .3s ease-in-out .3s}.tingle-enabled{position:fixed;right:0;left:0;overflow:hidden}.tingle-modal--visible .tingle-modal-box__footer{bottom:0}.tingle-enabled .tingle-content-wrapper{filter:blur(8px)}.tingle-modal--visible{visibility:visible;opacity:1}.tingle-modal--visible .tingle-modal-box{-ms-transform:scale(1);transform:scale(1)}.tingle-modal--overflow{overflow-y:scroll}.tingle-btn{display:inline-block;margin:0 .5rem;padding:1rem 2rem;border:none;background-color:grey;box-shadow:none;color:#fff;vertical-align:middle;text-decoration:none;font-size:inherit;font-family:inherit;line-height:normal;cursor:pointer;transition:background-color .4s ease}.tingle-btn--primary{background-color:#3498db}.tingle-btn--danger{background-color:#e74c3c}.tingle-btn--default{background-color:#34495e}.tingle-btn--pull-left{float:left}.tingle-btn--pull-right{float:right}@media (max-width:540px){.tingle-modal{top:0;display:flex;padding-top:60px;width:100%}.tingle-modal-box{width:auto;border-radius:0}.tingle-modal-box__content{overflow-y:scroll}.tingle-modal--noClose{top:0}.tingle-modal--noOverlayClose{padding-top:0}.tingle-modal-box__footer .tingle-btn{display:block;float:none;margin-bottom:1rem;width:100%}.tingle-modal__close{top:0;right:0;left:0;display:block;width:100%;height:60px;border:none;background-color:#2c3e50;box-shadow:none;color:#fff;line-height:55px}.tingle-modal__closeLabel{display:inline-block;vertical-align:middle;font-size:1.5rem;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif}.tingle-modal__closeIcon{display:inline-block;margin-right:.5rem;vertical-align:middle;font-size:4rem}}@supports ((-webkit-backdrop-filter:blur(12px)) or (backdrop-filter:blur(12px))){.tingle-modal{-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px)}@media (max-width:540px){.tingle-modal{-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px)}}.tingle-enabled .tingle-content-wrapper{filter:none}}.lyra_auth_header{width:100%;height:3em;background-color:#f5f5f5;display:flex;align-items:stretch;justify-content:center;padding:5px;position:relative}.lyra_auth_header input{flex-grow:1;border-radius:24px;border:none;text-align:center;font-size:1.2em;font-weight:400;text-overflow:ellipsis;padding:5px;position:relative}');return a(".lyngle .lyra_auth_header #url{width:calc(100% - 8px);height:21px;text-align:center;padding:2px;margin:0;border-radius:2px;border:2px solid #767676}.lyra_auth_loader{width:100%;height:calc(100% - 30px);position:absolute;padding:0;margin:0;border:0;background-color:#fff}.lyra_auth_loader .loading{position:absolute;top:50%;left:50%}.lyra_auth_loader .loading .bullet{position:absolute;padding:5px;border-radius:50%;background:#555;-webkit-animation:animIn 1s ease-in-out 0s infinite;animation:animIn 1s ease-in-out 0s infinite}.lyra_auth_loader .loading .bullet:first-child{-webkit-animation-delay:0s;animation-delay:0s}.lyra_auth_loader .loading .bullet:nth-child(2){-webkit-animation-delay:.15s;animation-delay:.15s}.lyra_auth_loader .loading .bullet:nth-child(3){-webkit-animation-delay:.3s;animation-delay:.3s}.lyra_auth_loader .loading .bullet:nth-child(4){-webkit-animation-delay:.45s;animation-delay:.45s}@-webkit-keyframes animIn{0%{left:-100px;opacity:0}50%{opacity:1}to{left:100px;opacity:0}}@keyframes animIn{0%{left:-100px;opacity:0}50%{opacity:1}to{left:100px;opacity:0}}.lyra_auth_loader .auth-msg-wrapper{font-size:16px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;position:absolute;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;width:100%;height:100%}.lyra_auth_loader .auth-msg-wrapper .auth-msg,.lyra_auth_loader .auth-msg-wrapper .wait-msg{font-family:Arial,Helvetica Neue,Helvetica,sans-serif;color:#333}.lyra_auth_loader .auth-msg-wrapper .auth-msg{margin-bottom:50px}.lyra_auth_loader .auth-msg-wrapper .wait-msg{margin-top:90px}"),s});